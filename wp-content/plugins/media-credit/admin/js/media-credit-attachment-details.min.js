/*! media-credit media-credit-attachment-details.js 2017-02-24 5:27:35 PM */
jQuery(function(a){var b=window.$mediaCredit||{};b.autoComplete=function(c,d,e){var f=function(a){c.model.set({mediaCreditAuthorID:"",mediaCreditAuthorDisplay:a,mediaCreditText:a}),e&&c.model.save()};return c.$el.find(d).autocomplete({autoFocus:!0,minLength:2,source:b.names||(b.names=_.map(b.id,function(a,b){return{id:b,value:a,label:a}})),select:function(b,d){return a(this).attr("value",d.item.value),c.model.set({mediaCreditAuthorID:d.item.id,mediaCreditAuthorDisplay:d.item.value,mediaCreditText:d.item.value}),e&&c.model.save(),!1},response:function(b,d){var e;if(0===d.content.length)return e=a(this).val(),e!==c.model.get("mediaCreditAuthorDisplay")&&f(e),!1},open:function(){return a(this).autocomplete("widget").css("z-index",2e6),!1}}).click(function(){this.select()}).change(function(d){var g=a(this),h=g.val(),i=b.noDefaultCredit||!1;i&&""===h&&""===c.model.get("mediaCreditAuthorID")?(c.model.set({mediaCreditAuthorID:c.model.get("author"),mediaCreditAuthorDisplay:c.model.get("authorName"),mediaCreditText:c.model.get("authorName")}),e&&c.model.save(),g.val("").attr("placeholder",c.model.get("mediaCreditAuthorDisplay")),d.stopImmediatePropagation(),d.preventDefault()):h!==c.model.get("mediaCreditAuthorDisplay")&&(f(h),d.stopImmediatePropagation(),d.preventDefault())})},wp.media.view.Attachment.Details&&(b.AttachmentDetails=wp.media.view.Attachment.Details.extend({template:function(a){return wp.media.template("attachment-details")(a)+wp.media.template("media-credit-attachment-details")(a)},render:function(){var a,c=b.noDefaultCredit||!1;wp.media.view.Attachment.prototype.render.apply(this,[]),a=b.autoComplete(this,'label[data-setting="mediaCreditText"] input[type="text"]',!0),c?(a.autocomplete("disable"),""!==this.model.get("mediaCreditAuthorID")&&a.val("").attr("placeholder",this.model.get("mediaCreditAuthorDisplay"))):a.autocomplete("enable")},updateSetting:function(b){var c=a(b.target);c.is('input[type="checkbox"]')&&(b.target.value=c.prop("checked")),wp.media.view.Attachment.prototype.updateSetting.apply(this,[b])}}),wp.media.view.Attachment.Details.prototype=b.AttachmentDetails.prototype),wp.media.view.Attachment.Details.TwoColumn&&(b.AttachmentDetailsTwoColumn=wp.media.view.Attachment.Details.TwoColumn.extend({template:function(b){var c=a(a.parseHTML(wp.media.template("attachment-details-two-column")(b)));return a(wp.media.template("media-credit-attachment-details")(b)).insertAfter(c.find(".attachment-compat").prevAll("*[data-setting]")[0]),c},updateSetting:function(a){wp.media.view.Attachment.Details.prototype.updateSetting.apply(this,[a])}}),wp.media.view.Attachment.Details.TwoColumn.prototype=b.AttachmentDetailsTwoColumn.prototype),wp.media.model.Attachment&&(b.AttachmentModel=wp.media.model.Attachment.extend({sync:function(c,d,e){var f,g=null;return _.isUndefined(this.id)?a.Deferred().rejectWith(this).promise():("update"===c&&d.hasChanged()&&(f=this.get("nonces"),f&&f.mediaCredit&&f.mediaCredit.update&&(e=e||{},e.context=this,e.data=_.extend(e.data||{},{action:"save-attachment-media-credit",id:this.id,nonce:f.mediaCredit.update,post_id:wp.media.model.settings.post.id}),d.hasChanged()&&(e.data.changes={},e.data.mediaCredit={},b.noDefaultCredit&&""===d.changed.mediaCreditText&&""!==d.get("mediaCreditAuthorID")&&delete d.changed.mediaCreditText,_.each(d.changed,function(a,b){0===b.indexOf("mediaCredit")&&(e.data.changes[b]=this.get(b),delete d.changed[b])},this),e.data.mediaCredit.text=d.get("mediaCreditText"),e.data.mediaCredit.link=d.get("mediaCreditLink"),e.data.mediaCredit.id=d.get("mediaCreditAuthorID"),e.data.mediaCredit.nofollow=d.get("mediaCreditNoFollow")),_.size(e.data.changes)>0&&(g=wp.media.ajax(e),delete e.data.changes,this.updateMediaCreditInEditorContent(a("textarea#content").val(),e),delete e.data.mediaCredit))),"update"!==c||d.hasChanged()?this.constructor.__super__.sync.apply(this,[c,d,e]):g?g:a.Deferred().rejectWith(this).promise())},updateMediaCreditInEditorContent:function(b,c){var d,e=this.get("nonces");b&&e&&e.mediaCredit&&e.mediaCredit.content&&(d=_.extend(c,{data:_.extend(c.data,{action:"update-media-credit-in-post-content",nonce:e.mediaCredit.content,mediaCredit:_.extend(c.data.mediaCredit,{content:b})}),success:function(c){var d;b!==c&&(d=tinymce.get("content"),d&&d instanceof tinymce.Editor&&a("#wp-content-wrap").hasClass("tmce-active")?(d.setContent(c),d.save({no_events:!0})):a("textarea#content").val(c))}}),wp.media.ajax("update-media-credit-in-post-content",d))}}),wp.media.model.Attachment.prototype=b.AttachmentModel.prototype)});