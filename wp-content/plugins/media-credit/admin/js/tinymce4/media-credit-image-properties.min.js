/*! media-credit media-credit-image-properties.js 2018-02-21 1:07:53 AM */

!function(e,t){"use strict";var a,i,d=window.$mediaCredit||{};t.media.events&&(a=t.Backbone.View.extend({className:"advanced-media-credit",template:t.media.template("media-credit-image-properties"),initialize:function(){t.Backbone.View.prototype.initialize.apply(this,arguments)},prepare:function(){return this.model.toJSON()},render:function(){return t.Backbone.View.prototype.render.apply(this,arguments),this}}),t.media.events.on("editor:frame-create",function(e){(i=e.frame).on("content:render:image-details",function(e){var t=new a({model:e.model});e.on("post-render",function(){e.views.insert(e.$el.find(".advanced-settings"),t.render().el,{at:1}),d.autoComplete(t,'input[data-setting="mediaCreditText"]',!1)})})}),t.media.events.on("editor:image-edit",function(e){""===e.metadata.mediaCreditText&&""!==e.metadata.mediaCreditAuthorID&&(e.metadata.mediaCreditText=d.id[e.metadata.mediaCreditAuthorID])}),t.media.events.on("editor:image-update",function(e){var t,a,r,n=e.editor.dom,o=e.image,m=i.content.get().model,c=m.get("align"),p=m.get("width"),s=m.get("mediaCreditText"),l=m.get("mediaCreditAuthorID"),u=m.get("mediaCreditLink"),g=m.get("mediaCreditNoFollow");a=o.parentNode&&"A"===o.parentNode.nodeName?n.getNext(o.parentNode,".mceMediaCreditTemp"):n.getNext(o,".mceMediaCreditTemp"),d.id[l]!==s&&(l=""),t=(t=l?d.id[l]+d.separator+d.organization:s).replace(/<[^>]+>(.*)<\/[^>]+>/g,"$1"),c="align"+(c||"none"),null===a&&(s||l)&&(a=n.create("span",{class:"mceMediaCreditTemp mceNonEditable","data-media-credit-author-id":l,"data-media-credit-text":s,"data-media-credit-align":c,"data-media-credit-link":u,"data-media-credit-nofollow":g},t),o.parentNode&&"A"===o.parentNode.nodeName?n.insertAfter(a,o.parentNode):n.insertAfter(a,o)),a&&(n.getParent(a,"dl.wp-caption")||(r=n.create("div",{class:"mceMediaCreditOuterTemp "+c,style:"width: "+(parseInt(p,10)+10)+"px"}),n.insertAfter(r,a.parentNode),n.add(r,a.parentNode),n.remove(a.parentNode,!0)),n.setAttrib(a,"data-media-credit-text",s),n.setAttrib(a,"data-media-credit-author-id",l),n.setAttrib(a,"data-media-credit-link",u),n.setAttrib(a,"data-media-credit-nofollow",g),n.setHTML(a,t))}))}(jQuery,wp);