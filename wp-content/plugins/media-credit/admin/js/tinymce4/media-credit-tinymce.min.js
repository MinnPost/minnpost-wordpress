/*! media-credit media-credit-tinymce.js 2017-02-24 5:27:35 PM */
tinymce.PluginManager.add("mediacredit",function(a){function b(b){return!(!a.dom.getAttrib(b,"data-mce-placeholder")&&!a.dom.getAttrib(b,"data-mce-object"))}function c(b){var c=a.$(b).parents("[contenteditable]");return c&&"false"===c.attr("contenteditable")}function d(b){var c;return c=b.replace(/(?:<p>)?\[(?:wp_)?caption([^\]]+)\]([\s\S]+?)\[\/(?:wp_)?caption\](?:<\/p>)?/g,function(b,c,d){var f,g,h,i,j,k;return f=c.match(/id=['"]([^'"]*)['"] ?/),f&&(c=c.replace(f[0],"")),g=c.match(/align=['"]([^'"]*)['"] ?/),g&&(c=c.replace(g[0],"")),h=c.match(/class=['"]([^'"]*)['"] ?/),h&&(c=c.replace(h[0],"")),k=c.match(/width=['"]([0-9]*)['"] ?/),k&&(c=c.replace(k[0],"")),d=t(d),j=d.match(/((?:\[media-credit[^\]]+\]\s*)(?:<a [^>]+>)?<img [^>]+>(?:<\/a>)?(?:\s*\[\/media-credit\])?)([\s\S]*)/i),j=null!==j?j:d.match(/((?:<a [^>]+>)?<img [^>]+>(?:<\/a>)?)([\s\S]*)/i),j&&j[2]?(i=t(j[2]),j=t(j[1])):(i=t(c).replace(/caption=['"]/,"").replace(/['"]$/,""),j=d),j=e(j),f=f&&f[1]?f[1].replace(/[<>&]+/g,""):"",g=g&&g[1]?g[1]:"alignnone",h=h&&h[1]?" "+h[1].replace(/[<>&]+/g,""):"",!k&&j&&(k=j.match(/width=['"]([0-9]*)['"]/)),k&&k[1]&&(k=k[1]),k&&i?(k=parseInt(k,10),a.getParam("wpeditimage_html5_captions")||(k+=10),'<div class="mceTemp"><dl id="'+f+'" class="wp-caption '+g+h+'" style="width: '+k+'px"><dt class="wp-caption-dt">'+j+'</dt><dd class="wp-caption-dd">'+i+"</dd></dl></div>"):d}),c=e(c,!0)}function e(b,c){c="undefined"!=typeof c&&c;var d;return d=c?/(?:<p>)?\[media-credit([^\]]+)\]([\s\S]+?)\[\/media-credit\](?:<\/p>)?/g:/\[media-credit([^\]]+)\]([\s\S]+?)\[\/media-credit\]/g,b.replace(d,function(b,d,e){var f,g,h,i,j,k,l,m,n,o=tinymce.trim;return f=d.match(/id=['"]?([0-9]+)['"]? ?/),f&&(d=d.replace(f[0],"")),g=d.match(/align=['"]([^'"]*)['"] ?/),g&&(d=d.replace(g[0],"")),h=d.match(/width=['"]([0-9]*)['"] ?/),h&&(d=d.replace(h[0],"")),l=d.match(/link=['"]([^'"]*)['"] ?/),l&&(d=d.replace(l[0],"")),nofollow=d.match(/nofollow=['"]([^'"]*)['"] ?/),nofollow&&(d=d.replace(nofollow[0],"")),m=d.match(/name=[']([^']*)['] ?/i),m||(m=d.match(/name=["]([^"]*)["] ?/i)),m&&(d=d.replace(m[0],"")),e=o(e),i=e.match(/((?:<a [^>]+>)?<img [^>]+>(?:<\/a>)?)([\s\S]*)/i),i&&i[1]&&(i=o(i[1])),f=f&&f[1]?f[1]:"",g=g&&g[1]?g[1]:"alignnone",l=l&&l[1]?l[1]:"",m=m&&m[1]?m[1]:"",!h&&i&&(h=i.match(/width=['"]([0-9]*)['"]/)),h&&h[1]&&(h=h[1]),h&&(m||f)?(j=parseInt(h,10),a.getParam("wpeditimage_html5_captions")||(j+=10),n=""+(m?m:$mediaCredit.id[f]+$mediaCredit.separator+$mediaCredit.organization),n=n.replace(/<[^>]+>(.*)<\/[^>]+>/g,"$1"),k=i+wp.html.string({tag:"span",content:n,attrs:{class:"mceMediaCreditTemp mceNonEditable","data-media-credit-author-id":f,"data-media-credit-text":_.escape(m),"data-media-credit-align":g,"data-media-credit-link":_.escape(l),"data-media-credit-nofollow":_.escape(nofollow)}}),c&&(k=wp.html.string({tag:"div",content:k,attrs:{class:"mceMediaCreditOuterTemp "+g,style:"width: "+j+"px"}})),k):e})}function f(a){var b;return b=a.replace(/(?:<div [^>]+mceTemp[^>]+>)?\s*(<dl [^>]+wp-caption[^>]+>[\s\S]+?<\/dl>)\s*(?:<\/div>)?/g,function(a,b){var c="";return b.indexOf("<img ")===-1||b.indexOf("</p>")!==-1?b.replace(/<d[ldt]( [^>]+)?>/g,"").replace(/<\/d[ldt]>/g,""):(c=b.replace(/\s*<dl ([^>]+)>\s*<dt [^>]+>([\s\S]+?)<\/dt>\s*<dd [^>]+>([\s\S]*?)<\/dd>\s*<\/dl>\s*/gi,function(a,b,c,d){var e,f,h,i;return i=c.match(/width="([0-9]*)"/),i=i&&i[1]?i[1]:"",f=b.match(/class="([^"]*)"/),f=f&&f[1]?f[1]:"",h=f.match(/align[a-z]+/i)||"alignnone",i&&d?(e=b.match(/id="([^"]*)"/),e=e&&e[1]?e[1]:"",f=f.replace(/wp-caption ?|align[a-z]+ ?/gi,""),f&&(f=' class="'+f+'"'),d=d.replace(/\r\n|\r/g,"\n").replace(/<[a-zA-Z0-9]+( [^<>]+)?>/g,function(a){return a.replace(/[\r\n\t]+/," ")}),d=d.replace(/\s*\n\s*/g,"<br />"),c=g(c),'[caption id="'+e+'" align="'+h+'" width="'+i+'"'+f+"]"+c+" "+d+"[/caption]"):("alignnone"!==h[0]&&(c=c.replace(/><img/,' class="'+h[0]+'"><img')),c)}),c.indexOf("[caption")===-1&&(c=b.breplace(/[\s\S]*?((?:<a [^>]+>)?<img [^>]+>(?:<\/a>)?)(<p>[\s\S]*<\/p>)?[\s\S]*/gi,"<p>$1</p>$2")),c)}),b=g(b,!0)}function g(a,b){b="undefined"!=typeof b&&b;var c=/((?:<a [^>]+>)?<img [^>]+>(?:<\/a>)?)<span class="mceMediaCreditTemp[^"]*" ([^>]*)>([\s\S]+?)<\/span>/g;return b&&(c=/<div class="mceMediaCreditOuterTemp[^"]*"[^>]*>((?:<a [^>]+>)?<img [^>]+>(?:<\/a>)?)<span class="mceMediaCreditTemp[^"]*" ([^>]*)>([\s\S]+?)<\/span><\/div>/g),a.replace(c,function(a,b,c,d){var e,f,g,i,j,k,l="";tinymce.trim;return b.indexOf("<img ")===-1?"<p>"+d+"</p>":(g=b.match(/width="([0-9]*)"/),g=g&&g[1]?g[1]:"",e=h(c,"data-media-credit-author-id","[0-9]+",!0),i=h(c,"data-media-credit-align","[^'\"]*",!1),f=_.unescape(h(c,"data-media-credit-text",'[^"]*',!1)),j=_.unescape(h(c,"data-media-credit-link",'[^"]*',!1)),nofollow=_.unescape(h(c,"data-media-credit-nofollow",'[^"]*',!1)),g&&(f||e)?(k=f.indexOf('"')>-1?"name='"+f+"'":'name="'+f+'"',credit=e?"id="+e:k,j&&(credit+=' link="'+j+'"'),nofollow&&"true"===nofollow&&(credit+=' nofollow="true"'),l="[media-credit "+credit+' align="'+i+'" width="'+g+'"]'+b+"[/media-credit]",0!==l.indexOf("[media-credit")&&(l=b.replace(/[\s\S]*?((?:<a [^>]+>)?<img [^>]+>(?:<\/a>)?)(<p>[\s\S]*<\/p>)?[\s\S]*/gi,"<p>$1</p>$2")),l):b)})}function h(a,b,c,d){var e=null;return d="undefined"!=typeof d&&d,d&&(search_pattern=new RegExp(b+"=("+c+") ?"),e=a.match(search_pattern)),e||(search_pattern=new RegExp(b+'="('+c+')" ?'),e=a.match(search_pattern)),e||(search_pattern=new RegExp(b+"='("+c+")' ?"),e=a.match(search_pattern)),e=e&&e[1]?e[1]:""}function i(b){var c,d,e,f,g,h,i,j,k,l=[],m=a.dom,n=/^\d+$/;return e={attachment_id:!1,size:"custom",caption:"",align:"none",extraClasses:"",link:!1,linkUrl:"",linkClassName:"",linkTargetBlank:!1,linkRel:"",title:"",mediaCreditText:"",mediaCreditAuthorID:"",mediaCreditLink:"",mediaCreditNoFollow:""},e.url=m.getAttrib(b,"src"),e.alt=m.getAttrib(b,"alt"),e.title=m.getAttrib(b,"title"),i=m.getAttrib(b,"width"),j=m.getAttrib(b,"height"),(!n.test(i)||parseInt(i,10)<1)&&(i=b.naturalWidth||b.width),(!n.test(j)||parseInt(j,10)<1)&&(j=b.naturalHeight||b.height),e.customWidth=e.width=i,e.customHeight=e.height=j,c=tinymce.explode(b.className," "),d=[],tinymce.each(c,function(a){/^wp-image/.test(a)?e.attachment_id=parseInt(a.replace("wp-image-",""),10):/^align/.test(a)?e.align=a.replace("align",""):/^size/.test(a)?e.size=a.replace("size-",""):d.push(a)}),e.extraClasses=d.join(" "),e.captionClassName=l.join(" "),f=m.getParents(b,".wp-caption"),f.length&&(f=f[0],c=f.className.split(" "),tinymce.each(c,function(a){/^align/.test(a)?e.align=a.replace("align",""):a&&"wp-caption"!==a&&l.push(a)}),g=m.select("dd.wp-caption-dd",f),g.length&&(g=g[0],e.caption=a.serializer.serialize(g).replace(/<br[^>]*>/g,"$&\n").replace(/^<p>/,"").replace(/<\/p>$/,""))),b.parentNode&&"A"===b.parentNode.nodeName&&(h=b.parentNode,e.linkUrl=m.getAttrib(h,"href"),e.linkTargetBlank="_blank"===m.getAttrib(h,"target"),e.linkRel=m.getAttrib(h,"rel"),e.linkClassName=h.className),k=h?m.getNext(h,".mceMediaCreditTemp"):m.getNext(b,".mceMediaCreditTemp"),k&&(e.align=e.align&&"none"!=e.align?e.align:m.getAttrib(k,"data-media-credit-align","").replace("align",""),e.mediaCreditText=m.getAttrib(k,"data-media-credit-text",""),e.mediaCreditAuthorID=m.getAttrib(k,"data-media-credit-author-id",""),e.mediaCreditLink=m.getAttrib(k,"data-media-credit-link",""),e.mediaCreditNoFollow=m.getAttrib(k,"data-media-credit-nofollow","")),e}function j(a){return a&&!(!a.textContent&&!a.innerText)}function k(b){return!b||b.indexOf("<")===-1&&b.indexOf(">")===-1?b:(p||(p=new tinymce.html.Serializer({},a.schema)),p.serialize(a.parser.parse(b,{forced_root_block:!1})))}function l(b,c){var d,e,f,g,h,i,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A=a.dom;d=tinymce.explode(c.extraClasses," "),d||(d=[]),f=b.parentNode&&"A"===b.parentNode.nodeName&&!j(b.parentNode)?b.parentNode:b,v=A.getNext(f,".mceMediaCreditTemp"),c.caption||(v?A.setAttrib(v,"data-media-credit-align","align"+c.align):d.push("align"+c.align)),c.attachment_id&&(d.push("wp-image-"+c.attachment_id),c.size&&"custom"!==c.size&&d.push("size-"+c.size)),s=c.width,t=c.height,"custom"===c.size&&(s=c.customWidth,t=c.customHeight),q={src:c.url,width:s||null,height:t||null,alt:c.alt,title:c.title||null,class:d.join(" ")||null},A.setAttribs(b,q),r={href:c.linkUrl,rel:c.linkRel||null,target:c.linkTargetBlank?"_blank":null,class:c.linkClassName||null},b.parentNode&&"A"===b.parentNode.nodeName&&!j(b.parentNode)?c.linkUrl?A.setAttribs(b.parentNode,r):A.remove(b.parentNode,!0):c.linkUrl&&((l=A.getParent(b,"a"))&&A.insertAfter(b,l),l=A.create("a",r),b.parentNode.insertBefore(l,b),l.appendChild(b)),m=a.dom.getParent(b,".mceTemp"),s=parseInt(s,10),a.getParam("wpeditimage_html5_captions")||(s+=10),c.caption?(c.caption=k(c.caption),p=c.attachment_id?"attachment_"+c.attachment_id:null,u="align"+(c.align||"none"),e="wp-caption "+u,c.captionClassName&&(e+=" "+c.captionClassName.replace(/[<>&]+/g,"")),v&&A.setAttrib(v,"data-media-credit-align",u),m?(o=A.select("dl.wp-caption",m),o.length&&A.setAttribs(o,{id:p,class:e,style:"width: "+s+"px"}),n=A.select(".wp-caption-dd",m),n.length&&A.setHTML(n[0],c.caption)):(p=p?'id="'+p+'" ':"",g="<dl "+p+'class="'+e+'" style="width: '+s+'px"><dt class="wp-caption-dt"></dt><dd class="wp-caption-dd">'+c.caption+"</dd></dl>",i=A.create("div",{class:"mceTemp"},g),(h=A.getParent(f,"p"))||(h=A.getParent(f,".mceMediaCreditOuterTemp"))?(h.parentNode.insertBefore(i,h),A.remove(f),v&&A.remove(v)):f.parentNode.insertBefore(i,f),f=a.$(i).find("dt.wp-caption-dt").append(f),h&&A.isEmpty(h)&&A.remove(h),v&&f.append(v))):(removeCreditNode=!c.mediaCreditText&&!c.mediaCreditAuthorID,m?(v=A.getNext(f,".mceMediaCreditTemp"),v&&!removeCreditNode?(u="align"+(c.align||"none"),h=A.create("div",{class:"mceMediaCreditOuterTemp "+u,style:"width: "+s+"px"})):h=A.create("p"),m.parentNode.insertBefore(h,m),h.appendChild(f),v&&!removeCreditNode&&h.appendChild(v),A.remove(m)):(w=A.getParent(v,".mceMediaCreditOuterTemp"),w&&(removeCreditNode?(h=A.create("p"),w.parentNode.insertBefore(h,w),h.appendChild(f),A.remove(w)):(u="align"+(c.align||"none"),w.className=w.className.replace(/ ?align(left|center|right|none)/g," ")+u,A.setAttrib(w,"style","width: "+s+"px")))),x=a.$(b),y=x.attr("srcset"),z=x.attr("src"),y&&z&&(z=z.replace(/[?#].*/,""),y.indexOf(z)===-1&&x.attr("srcset",null).attr("sizes",null))),wp.media.events&&wp.media.events.trigger("editor:image-update",{editor:a,metadata:c,image:b}),a.nodeChanged()}function m(b){var c,d;return"undefined"!=typeof wp&&wp.media?(metadata=i(b),wp.media.events.trigger("editor:image-edit",{editor:a,metadata:metadata,image:b}),c=wp.media({frame:"image",state:"image-details",metadata:metadata}),wp.media.events.trigger("editor:frame-create",{frame:c}),d=function(d){a.focus(),a.undoManager.transact(function(){l(b,d)}),c.detach()},c.state("image-details").on("update",d),c.state("replace-image").on("replace",d),c.on("close",function(){a.focus(),c.detach()}),void c.open()):void a.execCommand("mceImage")}function n(b){var c=a.dom.getParent(b,"div.mceTemp")||a.dom.getParent(b,"div.mceMediaCreditOuterTemp");c||"IMG"!==b.nodeName||(c=a.dom.getParent(b,"a")),c?(c.nextSibling?a.selection.select(c.nextSibling):c.previousSibling?a.selection.select(c.previousSibling):a.selection.select(c.parentNode),a.selection.collapse(!0),a.dom.remove(c)):a.dom.remove(b),a.nodeChanged(),a.undoManager.add()}var o,p,q,r,s=tinymce.each,t=tinymce.trim,u=tinymce.Env.iOS;return a.addButton("wp_img_remove",{tooltip:"Remove",icon:"dashicon dashicons-no",onclick:function(){n(a.selection.getNode())}}),a.addButton("wp_img_edit",{tooltip:"Edit ",icon:"dashicon dashicons-edit",onclick:function(){m(a.selection.getNode())}}),s({alignleft:"Align left",aligncenter:"Align center",alignright:"Align right",alignnone:"No alignment"},function(b,c){var d=c.slice(5);a.addButton("wp_img_"+c,{tooltip:b,icon:"dashicon dashicons-align-"+d,cmd:"alignnone"===c?"wpAlignNone":"Justify"+d.slice(0,1).toUpperCase()+d.slice(1),onPostRender:function(){var b=this;a.on("NodeChange",function(d){var e;"IMG"===d.element.nodeName&&(e=a.dom.getParent(d.element,".wp-caption")||d.element,"alignnone"===c?b.active(!/\balign(left|center|right)\b/.test(e.className)):b.active(a.dom.hasClass(e,c)))})}})}),a.once("preinit",function(){a.wp&&a.wp._createToolbar&&(o=a.wp._createToolbar(["wp_img_alignleft","wp_img_aligncenter","wp_img_alignright","wp_img_alignnone","wp_img_edit","wp_img_remove"]))}),a.on("wptoolbar",function(a){"IMG"!==a.element.nodeName||b(a.element)||(a.toolbar=o)}),u&&a.on("init",function(){a.on("touchstart",function(a){"IMG"!==a.target.nodeName||c(a.target)||(q=!0)}),a.dom.bind(a.getDoc(),"touchmove",function(){q=!1}),a.on("touchend",function(b){if(q&&"IMG"===b.target.nodeName&&!c(b.target)){var d=b.target;q=!1,window.setTimeout(function(){a.selection.select(d),a.nodeChanged()},100)}else o&&o.hide()})}),a.on("init",function(){var b=a.dom,c=a.getParam("wpeditimage_html5_captions")?"html5-captions":"html4-captions";b.addClass(a.getBody(),c),a.on("wpLoadImageForm",function(b){if(!a.getParam("wpeditimage_disable_captions")){var c={type:"textbox",flex:1,name:"wpcaption",minHeight:60,multiline:!0,scroll:!0,label:"Image caption"};b.data.splice(b.data.length-1,0,c)}}),a.on("wpNewImageRefresh",function(a){var c,d;(c=b.getParent(a.node,"dl.wp-caption"))&&(c.style.width||(d=parseInt(a.node.clientWidth,10)+10,d=d?d+"px":"50%",b.setStyle(c,"width",d)))}),a.on("wpImageFormSubmit",function(c){var d,e,f,g,h=c.imgData.data,i=c.imgData.node,j=c.imgData.wpcaption,l="",m="",n="",o=null;return h.id="__wp-temp-img-id",c.imgData.cancel=!0,h.style||(h.style=null),h.src?(j&&(j=j.replace(/\r\n|\r/g,"\n").replace(/<\/?[a-zA-Z0-9]+( [^<>]+)?>/g,function(a){return a.replace(/[\r\n\t]+/," ")}),j=j.replace(/(<br[^>]*>)\s*\n\s*/g,"$1").replace(/\s*\n\s*/g,"<br />"),j=k(j)),i?(o=i.id||null,b.setAttribs(i,h),d=b.getParent(i,"dl.wp-caption"),j?d?(e=b.select("dd.wp-caption-dd",d)[0])&&(e.innerHTML=j):(i.className&&(l=i.className.match(/wp-image-([0-9]+)/),m=i.className.match(/align(left|right|center|none)/)),m?(m=m[0],i.className=i.className.replace(/align(left|right|center|none)/g,"")):m="alignnone",m=' class="wp-caption '+m+'"',l&&(l=' id="attachment_'+l[1]+'"'),n=h.width||i.clientWidth,n&&(n=parseInt(n,10),a.getParam("wpeditimage_html5_captions")||(n+=10),n=' style="width: '+n+'px"'),f=i.parentNode&&"A"===i.parentNode.nodeName?i.parentNode:i,g="<dl "+l+m+n+'><dt class="wp-caption-dt"></dt><dd class="wp-caption-dd">'+j+"</dd></dl>",d=b.create("div",{class:"mceTemp"},g),(e=b.getParent(f,"p"))?e.parentNode.insertBefore(d,e):f.parentNode.insertBefore(d,f),a.$(d).find("dt.wp-caption-dt").append(f),e&&b.isEmpty(e)&&b.remove(e)):d&&(g="A"===i.parentNode.nodeName?b.getOuterHTML(i.parentNode):b.getOuterHTML(i),e=b.create("p",{},g),b.insertAfter(e,d.parentNode),a.selection.select(e),a.nodeChanged(),b.remove(d.parentNode))):(g=b.createHTML("img",h),j?(f=a.selection.getNode(),h.width&&(n=parseInt(h.width,10),a.getParam("wpeditimage_html5_captions")||(n+=10),n=' style="width: '+n+'px"'),g='<dl class="wp-caption alignnone"'+n+'><dt class="wp-caption-dt">'+g+'</dt><dd class="wp-caption-dd">'+j+"</dd></dl>",e="P"===f.nodeName?f:b.getParent(f,"p"),e&&"P"===e.nodeName?(d=b.create("div",{class:"mceTemp"},g),b.insertAfter(d,e),a.selection.select(d),a.nodeChanged(),b.isEmpty(e)&&b.remove(e)):a.selection.setContent('<div class="mceTemp">'+g+"</div>")):a.selection.setContent(g)),i=b.get("__wp-temp-img-id"),b.setAttrib(i,"id",o||null),void(c.imgData.node=i)):void(i&&((d=b.getParent(i,"div.mceTemp"))?b.remove(d):"A"===i.parentNode.nodeName?b.remove(i.parentNode):b.remove(i),a.nodeChanged()))}),a.on("wpLoadImageData",function(c){var d,e=c.imgData.data,f=c.imgData.node;(d=b.getParent(f,"dl.wp-caption"))&&(d=b.select("dd.wp-caption-dd",d)[0],d&&(e.wpcaption=a.serializer.serialize(d).replace(/<br[^>]*>/g,"$&\n").replace(/^<p>/,"").replace(/<\/p>$/,"")))}),tinymce.Env.ie&&tinymce.Env.ie>10&&b.bind(a.getBody(),"mscontrolselect",function(c){"IMG"===c.target.nodeName&&b.getParent(c.target,".wp-caption")?a.getBody().focus():"DL"===c.target.nodeName&&b.hasClass(c.target,"wp-caption")&&c.target.focus()})}),a.on("ObjectResized",function(b){var c=b.target;"IMG"===c.nodeName&&a.undoManager.transact(function(){var c,d,e=b.target,f=a.dom;"IMG"===e.nodeName&&(e.className=e.className.replace(/\bsize-[^ ]+/,""),(c=f.getParent(e,".wp-caption"))&&(d=b.width||f.getAttrib(e,"width"),d&&(d=parseInt(d,10),a.getParam("wpeditimage_html5_captions")||(d+=10),f.setStyle(c,"width",d+"px"))))})}),a.on("pastePostProcess",function(b){a.dom.getParent(a.selection.getNode(),"dd.wp-caption-dd")&&(a.$("img, audio, video, object, embed, iframe, script, style",b.node).remove(),a.$("*",b.node).each(function(b,c){a.dom.isBlock(c)&&(tinymce.trim(c.textContent||c.innerText)?(a.dom.insertAfter(a.dom.create("br"),c),a.dom.remove(c,!0)):a.dom.remove(c))}),a.$("br",b.node).each(function(b,c){c.nextSibling&&"BR"!==c.nextSibling.nodeName&&c.previousSibling&&"BR"!==c.previousSibling.nodeName||a.dom.remove(c)}),r=!0)}),a.on("BeforeExecCommand",function(b){var c,d,e,f,g,h,i,j=b.command,k=a.dom;if("mceInsertContent"===j||"Indent"===j||"Outdent"===j){if(c=a.selection.getNode(),h=k.getParent(c,"div.mceTemp")||k.getParent(c,"div.mceMediaCreditOuterTemp")){if("mceInsertContent"!==j)return b.preventDefault(),b.stopImmediatePropagation(),!1;if(r)return void(r=!1);d=k.create("p"),k.insertAfter(d,h),a.selection.setCursorLocation(d,0),a.nodeChanged()}}else if("JustifyLeft"===j||"JustifyRight"===j||"JustifyCenter"===j||"wpAlignNone"===j){if(c=a.selection.getNode(),f="align"+j.slice(7).toLowerCase(),e=a.dom.getParent(c,".wp-caption"),"IMG"!==c.nodeName&&!e)return;if(c=e||c,i=k.getNext(k.getParent(c,"a"),".mceMediaCreditTemp")||k.select(".mceMediaCreditTemp",c),g=a.dom.hasClass(c,f)?" alignnone":" "+f,c.className=t(c.className.replace(/ ?align(left|center|right|none)/g,"")+g),i){k.setAttrib(i,"data-media-credit-align",f);var l=k.getParent(i,"div.mceMediaCreditOuterTemp");l&&(l.className=t(l.className.replace(/ ?align(left|center|right|none)/g,"")+g))}a.nodeChanged(),b.preventDefault(),o&&o.reposition(),a.fire("ExecCommand",{command:j,ui:b.ui,value:b.value})}}),a.on("keydown",function(b){var c,d,e,f,g=a.selection,h=b.keyCode,i=a.dom;if(VK=tinymce.util.VK,h===VK.ENTER)c=g.getNode(),d=i.getParent(c,"div.mceTemp"),d||(d=i.getParent(c,"div.mceMediaCreditOuterTemp")),d&&(i.events.cancel(b),tinymce.each(i.select("dt, dd",d),function(a){i.isEmpty(a)&&i.remove(a)}),f=tinymce.Env.ie&&tinymce.Env.ie<11?"":'<br data-mce-bogus="1" />',e=i.create("p",null,f),"DD"===c.nodeName?i.insertAfter(e,d):d.parentNode.insertBefore(e,d),a.nodeChanged(),g.setCursorLocation(e,0));else if((h===VK.DELETE||h===VK.BACKSPACE)&&(c=g.getNode(),"DIV"===c.nodeName&&(i.hasClass(c,"mceTemp")||i.hasClass(c,"mceMediaCreditOuterTemp"))?d=c:"IMG"!==c.nodeName&&"DT"!==c.nodeName&&"A"!==c.nodeName||(d=i.getParent(c,"div.mceTemp")||a.dom.getParent(c,"div.mceMediaCreditOuterTemp")),d))return i.events.cancel(b),n(c),!1}),tinymce.Env.gecko&&a.on("undo redo",function(){"IMG"===a.selection.getNode().nodeName&&a.selection.collapse()}),a.wpSetImgCaption=function(a){return d(a)},a.wpGetImgCaption=function(a){return f(a)},a.on("beforeGetContent",function(b){"raw"!==b.format&&a.$('img[id="__wp-temp-img-id"]').attr("id",null)}),a.on("BeforeSetContent",function(b){"raw"!==b.format&&(b.content=a.wpSetImgCaption(b.content))}),a.on("PostProcess",function(b){b.get&&(b.content=a.wpGetImgCaption(b.content))}),function(){var b;a.on("dragstart",function(){var c=a.selection.getNode();"IMG"===c.nodeName&&(b=a.dom.getParent(c,".mceTemp"),b||"A"!==c.parentNode.nodeName||j(c.parentNode)||(b=c.parentNode))}),a.on("drop",function(c){var d=a.dom,e=tinymce.dom.RangeUtils.getCaretRangeFromPoint(c.clientX,c.clientY,a.getDoc());e&&d.getParent(e.startContainer,".mceTemp")?c.preventDefault():b&&(c.preventDefault(),a.undoManager.transact(function(){e&&a.selection.setRng(e),a.selection.setNode(b),d.remove(b)})),b=null})}(),a.wp=a.wp||{},a.wp.isPlaceholder=b,{_do_shcode:d,_get_shcode:f}});